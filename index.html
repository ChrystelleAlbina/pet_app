<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Animaux Virtuels</title>
    <style>
        /* â€” styles identiques (raccourcis ici pour aller Ã  lâ€™essentiel) â€” */
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: #fff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .3);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        button {
            padding: 10px 20px;
            background: #4299e1;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .animal-card {
            display: inline-block;
            width: 200px;
            padding: 15px;
            margin: 10px;
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
            text-align: center;
        }

        .stat-bar {
            background: #e2e8f0;
            height: 20px;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 10px;
            transition: width .3s;
        }

        .energy {
            background: #48bb78;
        }

        .happiness {
            background: #ed8936;
        }

        .health {
            background: #e53e3e;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¾ Animaux Virtuels</h1>

        <div class="controls">
            <input type="text" id="animalName" placeholder="Nom" value="Fluffy">
            <select id="animalType">
                <option value="chat">Chat ğŸ±</option>
                <option value="chien">Chien ğŸ¶</option>
                <option value="lapin">Lapin ğŸ°</option>
                <option value="hamster">Hamster ğŸ¹</option>
                <option value="oiseau">Oiseau ğŸ¦</option>
                <option value="tortue">Tortue ğŸ¢</option>
                <option value="poisson">Poisson ğŸ </option>
                <option value="souris">Souris ğŸ­</option>
            </select>
            <button onclick="creerAnimal()">CrÃ©er un Animal</button>
            <button onclick="supprimerTous()">Supprimer Tous</button>
        </div>

        <div id="animalsContainer"></div>
    </div>

    <script>
        /* ---------- Classe et donnÃ©es ---------- */
        class Animal {
            constructor(nom, type, emoji) {
                this.nom = nom; this.type = type; this.emoji = emoji;
                this.energie = 100; this.bonheur = 100; this.sante = 100; this.age = 0;
            }
            manger() { this.energie = Math.min(100, this.energie + 20); this.bonheur = Math.min(100, this.bonheur + 10); }
            jouer() { this.energie = Math.max(0, this.energie - 15); this.bonheur = Math.min(100, this.bonheur + 25); }
            dormir() { this.energie = Math.min(100, this.energie + 30); this.sante = Math.min(100, this.sante + 10); }
            vieillir() { this.age++; this.sante = Math.max(0, this.sante - 5); }
        }
        const animalEmojis = { chat: 'ğŸ±', chien: 'ğŸ¶', lapin: 'ğŸ°', hamster: 'ğŸ¹', oiseau: 'ğŸ¦', tortue: 'ğŸ¢', poisson: 'ğŸ ', souris: 'ğŸ­' };
        let animaux = [];

        /* ---------- UI ---------- */
        function afficherAnimaux() {
            const c = document.getElementById("animalsContainer"); c.innerHTML = "";
            animaux.forEach((a, i) => c.insertAdjacentHTML("beforeend", `
    <div class="animal-card">
      <div style="font-size:3em">${a.emoji}</div><h3>${a.nom}</h3>
      <p>${a.type} â€¢ ${a.age} an(s)</p>
      <div><small>Ã‰nergie ${a.energie}%</small><div class="stat-bar"><div class="stat-fill energy" style="width:${a.energie}%"></div></div></div>
      <div><small>Bonheur ${a.bonheur}%</small><div class="stat-bar"><div class="stat-fill happiness" style="width:${a.bonheur}%"></div></div></div>
      <div><small>SantÃ© ${a.sante}%</small><div class="stat-bar"><div class="stat-fill health" style="width:${a.sante}%"></div></div></div>
      <div class="controls">
        <button onclick="actionAnimal(${i},'manger')">ğŸ</button>
        <button onclick="actionAnimal(${i},'jouer')">ğŸ®</button>
        <button onclick="actionAnimal(${i},'dormir')">ğŸ˜´</button>
        <button onclick="actionAnimal(${i},'vieillir')">â°</button>
      </div>
      <button onclick="supprimerAnimal(${i})" style="background:#e53e3e;margin-top:6px;">âŒ Supprimer</button>
    </div>`));
            if (!animaux.length) c.textContent = "Aucun animal.";
        }

        /* ---------- CrÃ©ation ---------- */
        function creerAnimal() {
            const nom = document.getElementById("animalName").value.trim();
            if (!nom) return alert("Entrez un nom !");
            const type = document.getElementById("animalType").value;
            const a = new Animal(nom, type, animalEmojis[type]);
            animaux.push(a); document.getElementById("animalName").value = "";
            afficherAnimaux();

            /* ----- ENVOI AU FICHIER JSON via le serveur Node ----- */
            fetch("/animals", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(a) })
                .catch(() => alert("âš ï¸Â Impossible d'Ã©crire dans data.json"));
        }

        /* ---------- Autres interactions ---------- */
        function actionAnimal(i, act) { animaux[i][act](); afficherAnimaux(); }
        const supprimerAnimal = i => { animaux.splice(i, 1); afficherAnimaux(); };
        const supprimerTous = () => { if (animaux.length) { animaux = []; afficherAnimaux(); } };

        /* ---------- RÃ©cupÃ©ration des animaux dÃ©jÃ  stockÃ©s ---------- */
        window.onload = () => fetch("/animals").then(r => r.json())
            .then(list => {
                animaux = list.map(o => Object.assign(new Animal(o.nom, o.type, o.emoji), o));
                afficherAnimaux();
            }).catch(() => afficherAnimaux());
    </script>
</body>

</html>